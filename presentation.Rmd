---
title: "ETC5523 Group Presentation"  
author: 
  - "Priscila Grecov"
  - "Mayunk Bharadwaj"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [default, metropolis, metropolis-fonts]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)

knitr::opts_chunk$set(echo = FALSE,warning = FALSE, message = FALSE, fig.retina = 3)

library(lubridate)
library(visdat)
library(tidyverse)
library(knitr)
library(leaflet)
library(ggridges)
library(hrbrthemes)
library(viridis)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#1381B0",
  secondary_color = "#FF961C",
  inverse_header_color = "#FFFFFF"
)
```

```{r, include=FALSE}
sensor_readings <- read.csv("Microclimate_Sensor_Readings.csv")
sensor_local <- read.csv("Microclimate_Sensor_Locations.csv")

sensor_readingsRH <- sensor_readings %>% filter(sensor_id=="5b.EPA-1h")
sensor_readingsRH$timeStamp <- format(as.POSIXct(sensor_readingsRH$local_time, format = "%Y/%m/%d %I:%M:%S %p",tz="UTC"),tz="Australia/Sydney")
sensor_readingsRH$date <- as.Date(sensor_readingsRH$timeStamp)
sensor_readingsRH$hour <- hour(sensor_readingsRH$timeStamp)
sensor_readingsRH$month <- month(sensor_readingsRH$timeStamp)

```

class: inverse, center, middle
.center[
# How does relative humidity change in Melbourne throughout the day and the year? 

]

When is it most uncomfortable to walk around the city (humidity <30% or >60%)?

---
.center[
#Exploring the Data
]
- Data is from the City of Melbourne's Open Data [site](https://data.melbourne.vic.gov.au)

![Screengrab of Open Data homepage](images/opendata_screengrab.jpg)

---
.center[
#Exploring the Data
]
Two relevant datasets:

1. [Microclimate Sensor Readings](https://data.melbourne.vic.gov.au/Environment/Microclimate-Sensor-Readings/u4vh-84j8?src=featured_banner)

2. [Microclimate Sensor Locations](https://data.melbourne.vic.gov.au/Environment/Microclimate-Sensor-Locations/irqv-hjr4)
---
.center[
#Microclimate Sensor Readings
]

##About the dataset

1343202 observations of 7 variables

```{r}
names(sensor_readings)
```

##What do the variables mean?

- *site_id*: unique site identification
- *sensor_id*: unique sensor ID
- *value*: sensor value
- *local_time*: Date/Time of reading in UTC
- *type*: Name of sensor type
- *units*: Units of measurement

---
.center[
#Microclimate Sensor Readings
]
##What's relevant to us?

- `local_time` is in UTC - needs to be converted to Melbourne time
- data collection starts in mid-November 2019.
- Many sensor types that measure lots of different aspects of the microclimate

```{r, message=FALSE, warning=FALSE}
unique(sensor_readings$sensor_id)
```

We are concerned with humidity, so we are only interested with sensor types: 

- **TPH.RH (sensor_id: 5b)** --> measures Relative Humidity (%);
- **TPH.RH-EPA-1h (sensor_id: 5b.EPA-1hr)** --> measures Relative Humidity 1hr-averaged (%).

Our analysis will focus on **TPH.RH-EPA-1h**.
---
.center[
#Is the data complete?
]

- Data is filtered on sensor_id: 5b.EPA-1hr

.center[
```{r}
vis_miss(sensor_readingsRH)
```
]
---
.center[
#Microclimate Sensor Locations
]

```{r}
sensor_local %>%
  select(site_id,description) %>%
  rename("Site ID"=site_id,
         "Address"=description) %>%
  knitr::kable(format = "html")
```
---
.center[
#Where are the sensors located?
]

.center[
```{r, message=FALSE, warning=FALSE, out.width="100%"}
leaflet(data = sensor_local) %>%
  addTiles() %>%
  addMarkers()
```
]
---
.center[
# Day-to-day view of Humidity

```{r during-year, out.width="100%", fig.height=4}
sensor_readingsRH %>%
  filter(sensor_id == "5b.EPA-1h") %>%
  group_by(site_id,date) %>%
  summarise(mean_RH = mean(value), .groups = 'drop') %>%
  ggplot(aes(x=date, y=mean_RH, group=site_id, color=site_id)) +
  geom_line() +
  geom_line(aes(y=60), color="black", linetype = "dotted") +
  geom_line(aes(y=30), color="black", linetype = "dashed") +
  theme_ipsum() +
  xlab("") +
  ylab("Mean Relative Humidity (%)") +
  scale_x_date(date_labels = "%Y-%m-%d", date_breaks  = "10 days") +
  theme(axis.text.x=element_text(angle=60, hjust=1, size = 8)) +
  ggtitle("Mean Relative Humidity (%) by Sensor over time")
```
]
---
.center[
#Day-to-day view of Humidity

```{r, out.width="100%", fig.height=4}
sensor_readingsRH %>%
  filter(sensor_id == "5b.EPA-1h") %>%
  group_by(date) %>%
  summarise(mean_RH = mean(value), median_RH = median(value), .groups = 'drop') %>%
  ggplot(aes(x=date)) +
  geom_line(aes(y=mean_RH), color="blue") +
  #geom_line(aes(y=median_RH), color="red") +
  geom_line(aes(y=60), color="red", linetype = "dashed") +
  geom_line(aes(y=30), color="red", linetype = "dashed") +
  theme_ipsum() +
  xlab("") +
  ylab("Mean Relative Humidity (%)") +
  scale_x_date(date_labels = "%Y-%m-%d", date_breaks  = "10 days") +
  theme(axis.text.x=element_text(angle=60, hjust=1, size = 8)) +
  ggtitle("Mean Relative Humidity (%) over time")
```
]
---
.center[
#Day-to-day view of Humidity

```{r, out.width="100%", fig.height=4}
sensor_readingsRH %>%
  filter(sensor_id == "5b.EPA-1h") %>%
  group_by(date) %>%
  summarise(mean_RH = median(value), .groups = 'drop') %>%
  ggplot(aes(x=date, y=mean_RH)) +
  geom_line() +
  geom_line(aes(y=60), color="red", linetype = "dashed") +
  geom_line(aes(y=30), color="red", linetype = "dashed") +
  theme_ipsum() +
  xlab("") +
  ylab("Median Relative Humidity (%)") +
  scale_x_date(date_labels = "%Y-%m-%d", date_breaks  = "10 days") +
  theme(axis.text.x=element_text(angle=60, hjust=1, size = 8)) +
  ggtitle("Median Relative Humidity (%) over time")
```
]

- N.B: Just three days during all the year presented daily median below 30%: 21/11/2019, 31/01/2020.
---
.center[
#Month-to-month view of Humidity

```{r out.width="100%", fig.height=3.5}

sensor_readingsRH %>%
  filter(sensor_id == "5b.EPA-1h") %>%
  group_by(month) %>%
  summarise(mean_RH = mean(value), median_RH = median(value), .groups = 'drop') %>%
  ggplot(aes(x=month)) +
  geom_line(aes(y=mean_RH), color="blue") +
  geom_line(aes(y=median_RH), color="red") +
  geom_line(aes(y=60), color="black", linetype = "dashed") +
  geom_line(aes(y=30), color="black", linetype = "dashed") +
  theme_ipsum() +
  xlab("Month") +
  ylab("Mean and Median Relative Humidity (%)") +
  labs(color="Legend") +
  scale_x_continuous(breaks = seq(1,12,1)) +
  ggtitle("Mean (blue) and Median (red) Relative Humidity (%) over time")
```
]

- The months of May to August are the worst months where the relative humidity (RH) averages are much greater than 60%. November seems to be the month with the lowest RH average (but in this dataset we have just the the second half of data for November).
---
.center[
#Month-to-month view of Humidity
```{r out.width="100%", fig.height=4}

ggplot(sensor_readingsRH, aes(x = value, y = as.factor(month), fill=month)) + 
  geom_density_ridges() +
  theme_ridges() +
  labs(title = "Densities of Relative Humidity (%) by Month") +
  ylab("Month") +
  xlab("Relative Humidity (%)") +
  theme(legend.position = "none")

```
]
---
.center[
#Hour-by-hour view of Humidity

```{r out.width="100%", fig.height=4}
sensor_readingsRH %>%
  filter(sensor_id == "5b.EPA-1h") %>%
  group_by(site_id, hour) %>%
  summarise(mean_RH = mean(value), .groups = 'drop') %>%
  ggplot(aes(x=hour, y=mean_RH, group=site_id, color=site_id)) +
  geom_line(aes(y=60), color="black", linetype = "dashed") +
  geom_line(aes(y=30), color="black", linetype = "dashed") +
  geom_line() +
  theme_ipsum() +
  xlab("Hour in day") +
  ylab("Mean Relative Humidity (%)") +
  scale_x_continuous(breaks = seq(0,23,1)) +
  ggtitle("Mean Relative Humidity (%) throughout the day")
```
]
---
.center[
#Hour-by-hour view of Humidity
```{r out.width="100%", fig.height=4}
sensor_readingsRH %>%
  filter(sensor_id == "5b.EPA-1h") %>%
  group_by(hour) %>%
  summarise(mean_RH = mean(value), median_RH = median(value), .groups = 'drop') %>%
  ggplot(aes(x=hour)) +
  geom_line(aes(y=mean_RH), color="blue") +
  geom_line(aes(y=median_RH), color="red") +
  geom_line(aes(y=60), color="black", linetype = "dashed") +
  geom_line(aes(y=30), color="purple", linetype = "dashed") +
  theme_ipsum() +
  xlab("Hour in day") +
  ylab("Mean and Median Relative Humidity (%)") +
  scale_x_continuous(breaks = seq(0,23,1)) +
  ggtitle("Mean (blue) and Median (red) Humidity throughout the day")
```
]
---
.center[
#Hour-to-hour view of Humidity
```{r out.width="100%", fig.height=4}

ggplot(sensor_readingsRH, aes(x = value, y = as.factor(hour), fill=hour)) + 
  geom_density_ridges() +
  theme_ridges() +
  labs(title = "Densities of Relative Humidity (%) by Hour") +
  ylab("Hour") +
  xlab("Relative Humidity (%)") +
  theme(legend.position = "none")

```
]
---
.center[
#Putting it all together
```{r out.width="100%", fig.height=4}
sensor_readingsRH %>%
  filter(sensor_id == "5b.EPA-1h") %>%
  group_by(month, hour) %>%
  summarise(mean_RH = mean(value), median_RH = median(value), .groups = 'drop') %>%
  ggplot(aes(x=hour)) +
  geom_line(aes(y=mean_RH), color="blue") +
  geom_line(aes(y=median_RH), color="red") +
  geom_line(aes(y=60), color="black", linetype = "dotted") +
  geom_line(aes(y=30), color="purple", linetype = "dotted") +
  facet_wrap(vars(month)) +
  scale_x_continuous(breaks = seq(0,23,1)) +
  ylab("Mean Relative Humidity (%)") +
  xlab("Hour") +
  theme(axis.text.x=element_text(angle=60, hjust=1, size = 7))  +
  ggtitle("Mean Relative Humidity (%) throughout the day, faceted by month")


```
]
---
.center[
#In Conclusion
]
- Melbourne rarely has a low humidity (<30%) problem
- Melbourne does have a high humidity problem with average relative humidity generally above 60%. Especially so during winter.
- Nights in Melbourne are generally comfortable with average relative humidity levels below 60%. From 6am to 9pm, however, average relative humidity generally rises above 60%.


